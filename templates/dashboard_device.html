<!DOCTYPE html>
<html lang="en">

<head>
    {% include '_header.html' %}
</head>

<body class="hold-transition sidebar-mini layout-fixed layout-navbar-fixed layout-footer-fixed dark-mode">
    <!-- Content Wrapper. Contains page content -->
    <div class="wrapper">
        {% include '_side_bar.html' %}
        <div class="content-wrapper text-gray-dark">
            <!-- ? ************************************************ HTML CONTENT ******************************************************** -->
            <div class="info-box">
                <span class="info-box-icon bg-info elevation-1"><i class="fas fa-cog"></i></span>
                <div class="info-box-content">
                    <span class="info-box-text">Status of devices</span>
                </div>

            </div>
            <div class="w-100 row">
                <div class="col-sm-6">
                    <div class="card card-warning">
                        <div class="card-header">
                            <h3 class="card-title"><i class="fa fa-gear"></i> Setting Device <span id="device_info_name_setting">{{device.name}} (sn:{{device.sn}})</span></h3>

                        </div>

                        <div class="card-body">
                            <form>
                                <div class="form-group m-2">
                                    <button type="button" class="btn btn-outline-warning btn-block btn-lg" onclick="apply_setting_device_restart('{{device.id}}');"><i
                                            class="fa fa-power-off"></i>
                                        Restart</button>
                                </div>
                                <div class="card card-secondary border rounded-lg border-warning ">

                                    <div class="card-body row">
                                        <div class="col-sm-6 border rounded-lg p-2">
                                            <div class="card card-secondary text-secondary">
                                                <div class="card-header">
                                                    <h6>เปิดบริการตามช่วงเวลา</h6>
                                                </div>
                                                <div class="card-body">
                                                    <div class="row">
                                                        <div class="col-6">
                                                            ON TIME
                                                        </div>
                                                        <div class="col-6">
                                                            <input type="text" class="form-control" placeholder="08:00">
                                                        </div>
                                                    </div>

                                                    <div class="row">
                                                        <div class="col-6">
                                                            OFF TIME
                                                        </div>
                                                        <div class="col-6">
                                                            <input type="text" class="form-control" placeholder="20:00">
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="card-footer">
                                                    <button type="button" disabled class="btn btn-outline-secondary btn-sm" onclick="apply_setting_device_time('{{device.id}}');"><i
                                                            class="fa fa-gear"></i>
                                                        ตั้งค่าระบบ</button>
                                                </div>

                                            </div>


                                        </div>
                                        <div class="col-sm-6 border rounded-lg p-2">

                                            <div class="form-group">
                                                <div class="custom-control custom-switch custom-switch-off-secondary custom-switch-on-secondary">
                                                    <input disabled type="checkbox" {%if device_status[0]%} checked {% endif %} id="machine_active" class="custom-control-input">
                                                    <label class="custom-control-label" for="machine_active">Machine Active</label>
                                                </div>
                                                <div class="custom-control custom-switch custom-switch-off-secondary custom-switch-on-success">
                                                    <input type="checkbox" {%if device_status[1]%} checked {% endif %} id="multi_mode" class="custom-control-input">
                                                    <label class="custom-control-label" for="multi_mode">Multi Mode</label>
                                                </div>
                                                <div class="custom-control custom-switch custom-switch-off-secondary custom-switch-on-secondary">
                                                    <input disabled type="checkbox" {%if device_status[2]%} checked {% endif %} id="bill_active" class="custom-control-input">
                                                    <label class="custom-control-label" for="bill_active">เปิดรับ ธนบัตร</label>
                                                </div>
                                                <div class="custom-control custom-switch custom-switch-off-secondary custom-switch-on-secondary">
                                                    <input disabled type="checkbox" {%if device_status[3]%} checked {% endif %} id="coin_active" class="custom-control-input">
                                                    <label class="custom-control-label" for="coin_active">เปิดรับ Coin</label>
                                                </div>
                                                <div class="custom-control custom-switch custom-switch-off-secondary custom-switch-on-secondary">
                                                    <input disabled type="checkbox" {%if device_status[4]%} checked {% endif %} id="qr_active" class="custom-control-input">
                                                    <label class="custom-control-label" for="qr_active">เปิดรับ QR</label>
                                                </div>
                                            </div>
                                            <div class="card-footer">
                                                <button type="button" class="btn btn-outline-danger btn-sm" onclick="apply_setting_device_aciive('{{device.id}}');"><i
                                                        class="fa fa-gear"></i>
                                                    ตั้งค่าระบบ</button>
                                            </div>

                                        </div>
                                    </div>

                                </div>

                                <div class="card card-secondary border rounded-lg border-warning ">
                                    <div class="card-header">
                                        <h3 class="card-title">ราคาอัตราค่าบริการ</h3>
                                    </div>
                                    <div class="card-body text-center text-sm">
                                        <div class="form-group">
                                            <label>ค่าบริการฉีดน้ำ <output name="rate_01">{{price_rate[0]}}</output> (วินาที/บาท) </label>
                                            <input id="price_rate_01" type="range" class="custom-range custom-range-success" min="1" max="60" value={{price_rate[0]}}
                                                oninput="rate_01.value = this.value">
                                        </div>

                                        <div class="form-group">
                                            <label>ค่าบริการฉีดโฟม <output name="rate_02">{{price_rate[1]}}</output> (วินาที/บาท) </label>
                                            <input id="price_rate_02" type="range" class="custom-range custom-range-warning" min="1" max="60" value={{price_rate[1]}}
                                                oninput="rate_02.value = this.value">
                                        </div>

                                        <div class="form-group">
                                            <label>ค่าบริการเป่าลม <output name="rate_03">{{price_rate[2]}}</output> (วินาที/บาท) </label>
                                            <input id="price_rate_03" type="range" class="custom-range custom-range-info" min="1" max="60" value={{price_rate[2]}}
                                                oninput="rate_03.value = this.value">
                                        </div>

                                        <div class="form-group">
                                            <label>ค่าบริการน้ำประปา <output name="rate_04">{{price_rate[3]}}</output> (วินาที/บาท) </label>
                                            <input id="price_rate_04" type="range" class="custom-range custom-range-danger" min="1" max="60" value={{price_rate[3]}}
                                                oninput="rate_04.value = this.value">
                                        </div>

                                        <div class="form-group">
                                            <label class="text-gray">ค่าบริการดูดฝุ่น <output name="rate_05">{{price_rate[4]}}</output> (วินาที/บาท) </label>
                                            <input id="price_rate_05" type="range" class="custom-range custom-range-gray" min="1" max="60" value={{price_rate[4]}}
                                                oninput="rate_05.value = this.value">
                                        </div>

                                        <div class="form-group">
                                            <label class="text-gray">option 02 <output name="rate_06">{{price_rate[5]}}</output> (วินาที/บาท) </label>
                                            <input id="price_rate_06" type="range" class="custom-range custom-range-gray" min="1" max="60" value={{price_rate[5]}}
                                                oninput="rate_06.value = this.value">
                                        </div>

                                        <div class="form-group">
                                            <label class="text-gray">parked time out(***) <output name="rate_07">{{price_rate[6]}}</output> (วินาที/บาท) </label>
                                            <input id="price_rate_07" type="range" class="custom-range custom-range-gray" min="1" max="600" value={{price_rate[6]}}
                                                oninput="rate_07.value = this.value">
                                        </div>
                                    </div>
                                    <div class="form-group m-2">
                                        <button type="button" class="btn btn-outline-danger btn-block btn-lg" onclick="apply_setting_device_fntime('{{device.id}}');"><i
                                                class="fa fa-gear"></i>
                                            ตั้งค่าระบบ</button>
                                    </div>
                                </div>

                                <!-- <div class="card card-secondary border rounded-lg border-warning ">
                                    <div class="card-header">
                                        <div class="row">
                                            <div class="col-9">
                                                <h3 class="card-title">profile 02</h3>
                                            </div>
                                            <div class="col-3">
                                                <div class="custom-control custom-switch custom-switch-off-secondary custom-switch-on-danger">
                                                    <input type="checkbox" class="custom-control-input" id="customSwitch10">
                                                    <label class="custom-control-label" for="customSwitch10">เปิดใช้</label>
                                                </div>
                                            </div>
                                        </div>

                                    </div>

                                    <div class="card-body text-center text-sm">
                                        <div class="row text-sm align-items-center border rounded-lg mb-2">
                                            <div class="col-3">
                                                ช่วงเวลา
                                            </div>
                                            <div class="col-9">
                                                <input type="text" class="form-control" placeholder="Mon-Fri(22:00-08:00)">
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <label >ค่าบริการฉีดน้ำ <output name="rate_11">10</output> (วินาที/บาท) </label>
                                            <input type="range" class="custom-range custom-range-success" min="1" max="60" value="10" oninput="rate_11.value = this.value">
                                        </div>

                                        <div class="form-group">
                                            <label >ค่าบริการฉีดโฟม <output name="rate_12">10</output> (วินาที/บาท) </label>
                                            <input type="range" class="custom-range custom-range-warning" min="1" max="60" value="10" oninput="rate_12.value = this.value">
                                        </div>

                                        <div class="form-group">
                                            <label >ค่าบริการเป่าลม <output name="rate_13">10</output> (วินาที/บาท) </label>
                                            <input type="range" class="custom-range custom-range-info" min="1" max="60" value="10" oninput="rate_13.value = this.value">
                                        </div>

                                        <div class="form-group">
                                            <label >ค่าบริการน้ำประปา <output name="rate_14">10</output> (วินาที/บาท) </label>
                                            <input type="range" class="custom-range custom-range-danger" min="1" max="60" value="10" oninput="rate_14.value = this.value">
                                        </div>
                                    </div>
                                </div> -->





                            </form>
                        </div>

                    </div>
                </div>
                <div class="col-sm-6">
                    <div class="card card-info">
                        <div class="card-header">
                            <h3 class="card-title"><i class="fa fa-circle-info"></i>
                                <span id="device_info_name">{{device.name}}</span>
                            </h3>
                        </div>

                        <iframe id="grafana_frame" class="w-100 border rounded-lg border-dark" height="800"
                            src="https://grafana.devdls.com/d/wQ3db5P4k/dashboard-device?orgId=1&from=1681858069689&to=1681879669690&theme=dark&kiosk" title="description"></iframe>


                    </div>
                </div>
            </div>


            <!-- ? ************************************************************************************************************************ -->
        </div>
        {% include '_footer.html' %}
    </div>
</body>

{% include '_script.html' %}

<script>
    function on_select_device_chang(v) {
        debug(v);
        document.getElementById('grafana_frame').src = document.getElementById('grafana_frame').src
        document.getElementById('device_info_name_setting').innerText = v;
        document.getElementById('device_info_name').innerText = v;


        toastMixin.fire({
            //position: 'top',
            title: "<h5 style='color:black'>" + "Select device :" + v + "</h5>",
            background: bg_mode_theme,
            icon: "success",
        });

    }

    async function apply_setting_device_fntime(device_id) {
        const result = await Swal.fire({
            title: 'Are you sure?',
            text: "กรุณายืนยันการปรับตั้งค่า!",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Yes, (ตกลง)!'
        });
        if (result.isConfirmed) {
            if (result.isConfirmed) {
                const price_rate_01 = document.getElementById("price_rate_01").value;
                const price_rate_02 = document.getElementById("price_rate_02").value;
                const price_rate_03 = document.getElementById("price_rate_03").value;
                const price_rate_04 = document.getElementById("price_rate_04").value;
                const price_rate_05 = document.getElementById("price_rate_05").value;
                const price_rate_06 = document.getElementById("price_rate_06").value;
                const price_rate_07 = document.getElementById("price_rate_07").value;

                const formData = new FormData();
                formData.append("id", device_id);
                formData.append("price_rate_01", price_rate_01);
                formData.append("price_rate_02", price_rate_02);
                formData.append("price_rate_03", price_rate_03);
                formData.append("price_rate_04", price_rate_04);
                formData.append("price_rate_05", price_rate_05);
                formData.append("price_rate_06", price_rate_06);
                formData.append("price_rate_07", price_rate_07);

                const _reply = await fetchApi("/api_model/device_set_config/", "post", formData, "json");
                if (_reply.success) {

                    Swal.fire(
                        'Success!',
                        'ระะบบดำเนินการปรับตั้งค่าใหม่แล้วจะมีผลเมื่อตู้ดำเนินการ sync ข้อมูลกับระบบ\nโดยปกติจะมีผลภายใน 60 วินาที',
                        'success'
                    )
                } else {
                    Swal.fire({
                        icon: "error",
                        title: "unsuccessful",
                        html: _reply.msg,
                    });
                }
            }

        }

    }

    async function apply_setting_device_time(device_id) {
        const result = await Swal.fire({
            title: 'Are you sure?',
            text: "กรุณายืนยันการปรับตั้งค่า!",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Yes, (ตกลง)!'
        });
        if (result.isConfirmed) {
            if (result.isConfirmed) {
                Swal.fire(
                    'info!',
                    'Function is not avalable apply_setting_device_time',
                    'info'
                )
            }

        }

    }


    async function apply_setting_device_aciive(device_id) {
        const result = await Swal.fire({
            title: 'Are you sure?',
            text: "กรุณายืนยันการปรับตั้งค่า!",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Yes, (ตกลง)!'
        });
        if (result.isConfirmed) {
            if (result.isConfirmed) {
                const op01 = document.getElementById("machine_active").checked;
                const op02 = document.getElementById("multi_mode").checked;
                const op03 = document.getElementById("bill_active").checked;
                const op04 = document.getElementById("coin_active").checked;
                const op05 = document.getElementById("qr_active").checked;


                const formData = new FormData();
                formData.append("id", device_id);
                formData.append("op01", op01);
                formData.append("op02", op02);
                formData.append("op03", op03);
                formData.append("op04", op04);
                formData.append("op05", op05);



                const _reply = await fetchApi("/api_model/device_set_active/", "post", formData, "json");
                if (_reply.success) {

                    Swal.fire(
                        'Success!',
                        _reply.msg,
                        'success'
                    )
                } else {
                    Swal.fire({
                        icon: "error",
                        title: "unsuccessful",
                        html: _reply.msg,
                    });
                }
            }

        }

    }

    async function apply_setting_device_restart(device_id) {
        const result = await Swal.fire({
            title: 'Are you sure?',
            text: "กรุณายืนยันการ Reset Device!",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Yes, (ตกลง)!'
        });
        if (result.isConfirmed) {
            if (result.isConfirmed) {

                const _reply = await fetchApi("/api_model/device_restart/" + device_id, "post", null, "json");
                if (_reply.success) {

                    Swal.fire(
                        'Success!',
                        _reply.msg,
                        'success'
                    )
                } else {
                    Swal.fire({
                        icon: "error",
                        title: "unsuccessful",
                        html: _reply.msg,
                    });
                }
            }

        }

    }


</script>

</html>